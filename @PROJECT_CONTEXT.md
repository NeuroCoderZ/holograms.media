# PROJECT_CONTEXT.md - Актуальный Контекст Проекта Holograms Media

## 0. Статус
- Проект находится в активной разработке.
- Основная цель текущего этапа: Рефакторинг фронтенда, перенос монолитного кода из `script.js` в модули.

## 1. General Principles & Philosophy
- R&D Platform, Open Source (MIT), Итеративность, Нейрокодинг + Верификация, Ручной Контроль, Документирование, Безопасность.

## 2. Core Technologies & Stack (Целевая)
- Backend: Python 3.12, FastAPI, Uvicorn.
- Frontend: JavaScript (ES6 Modules), Three.js (r128+), HTML5, CSS3. Цель: WebGPU.
- База данных (Целевая): PostgreSQL с расширением `pgvector` (`asyncpg`).
- AI (LLM для Триа): LangChain, Mistral API.
- Мультимодальность: WebRTC, Web Audio API, MediaPipe Hands.
- Развертывание: Hugging Face Spaces (Docker).
- CI/CD: GitHub Actions.
- Долгосрочные Технологии (R&D): Вейвлет-анализ, WebAssembly, WebXR, "Инфокойн", Векторные БД, TypeScript.

## 3. Ключевые Файлы и Их Назначение
- `backend/app.py` (или `backend/main.py`): Бэкенд FastAPI.
- `frontend/index.html`: Главный HTML.
- `frontend/js/main.js`: Точка входа для ES6 модулей фронтенда.
- `frontend/script.js`: **Устаревший монолит. Подлежит ПОЛНОМУ РЕФАКТОРИНГУ.** Содержит оставшуюся логику, не перенесенную в модули.
- `frontend/js/core/init.js`: Инициализация глобального `state`.
- `frontend/js/3d/sceneSetup.js`: Инициализация Three.js/WebGPU сцены, объектов в `state`.
- `frontend/js/rendering.js`: Логика рендеринга и анимации Three.js.
- `frontend/js/core/resizeHandler.js`: Обработчик изменения размера окна для Three.js.
- `PROJECT_CONTEXT.md`: Главный файл с актуальным состоянием проекта для AI.
- `tria_memory_buffer.md`: Детальный лог итераций разработки (обновляется AI).

## 4. Правила Работы с Кодом
- Коммиты: Осмысленные, по конвенции. Ссылки на Issues.
- JavaScript: ES6+, модульность. РЕФАКТОРИНГ `script.js` – ВЫСШИЙ ПРИОРИТЕТ.
- Python: Async/await, PEP 8 (цель), логирование.
- PostgreSQL: Использование `asyncpg`, проектирование схем.

## 5. Взаимодействие с AI-Ассистентом (Trae IDE)
- Промптинг: Четкие микропромпты по "Универсальному Шаблону Промта v3.0".
- Ожидаемый Отчет от AI: Подтверждение, БЫЛО/СТАЛО, вывод команд, объяснение, предложения по обновлению контекста.
- Тестирование: AI выполняет базовые тесты. НейроКодер верифицирует.
- Git (через MCP GitHub или Terminal): Выполнение команд при наличии "ЗАДАЧА НА GIT". Сервер должен быть остановлен.

## 6. Текущие Приоритеты и Задачи
1. КРИТИЧНО: Устранение блокирующих JS ошибок в `script.js`.
2. РЕФАКТОРИНГ `frontend/script.js`: Последовательный перенос логики в модули.
3. ПОДГОТОВКА К PostgreSQL: Анализ кода бэкенда, планирование миграции.

## 7. Фокус на AI "Триа" и Жестах (Долгосрочно)
- Сбор "комбинированных аудио(видео)-чанков". Векторные эмбеддинги в PostgreSQL.

## 8. Важно для AI при модификации кода:
- Приоритет – рефакторинг `script.js` и устранение ошибок.
- Не удаляй код безвозвратно, если не уверен. Лучше закомментируй с `// TODO: ...`.
- Если задача неясна или противоречит `@PROJECT_CONTEXT.md`, уточни.

## Последние Ключевые Изменения
- [YYYY-MM-DD] Начало рефакторинга фронтенда, создание модульной структуры.
- [YYYY-MM-DD] Перенос части UI логики в `uiManager.js` и `panelManager.js`.
- [YYYY-MM-DD] Перенос логики аудио плеера в `audioFilePlayer.js`.
- [YYYY-MM-DD] Перенос логики управления микрофоном в `microphoneManager.js`.
- [YYYY-MM-DD] Перенос логики голосового ввода в `speechInput.js`.
- [YYYY-MM-DD] Перенос логики управления XR/камерой в `cameraManager.js`.
- [YYYY-MM-DD] Перенос логики инициализации Three.js сцены в `sceneSetup.js`.
- [YYYY-MM-DD] Перенос логики рендеринга и анимации в `rendering.js`.
- [YYYY-MM-DD] Перенос логики обработчика изменения размера окна в `resizeHandler.js`.
- [YYYY-MM-DD] Перенос логики обработчиков событий DOM в `domEventHandlers.js`.
- [YYYY-MM-DD] Перенос логики менеджера промптов в `promptManager.js`.
- [YYYY-MM-DD] Перенос логики менеджера версий в `versionManager.js`.
- [YYYY-MM-DD] Перенос логики визуализации области жестов в `gestureAreaVisualization.js`.
- [YYYY-MM-DD] Перенос логики отображения чата в `chatMessages.js`.
- [YYYY-MM-DD] Перенос логики инициализации MediaPipe Hands в `handsTracking.js`.

## Критические Известные Проблемы
- `script.js` все еще содержит значительный объем нерефакторенного кода (логика версионирования, сохранения/загрузки файлов, редактора кода, части аудио/жестов, глобальные переменные).
- **УСПЕХ:** Основная 3D-логика (инициализация сцены, цикл рендеринга) перенесена в `sceneSetup.js` и `rendering.js` и вызывается из `main.js`.
- **УСПЕХ:** Обработчик изменения размера окна перенесен в `resizeHandler.js` и вызывается из `main.js`.
- **УСПЕХ:** Инициализация и базовая обработка MediaPipe Hands перенесена в `handsTracking.js` и вызывается из `main.js`. Логика визуализации точек жестов все еще может присутствовать в `script.js`.
- Отсутствуют некоторые модули, на которые есть ссылки в `main.js` (помечены как `TODO`).
- Необходима полная интеграция всех новых модулей и тестирование фронтенда.