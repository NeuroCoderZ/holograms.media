Системная Инструкция: Проект "Голографические Медиа" (holograms.media) – Версия 32.0
Дата: 10 Июля 2024 г. (12:00 PM UTC, среда)

A. Общая Шапка Документа
(Версия и дата обновлены выше)

B. Финальный Вектор Развития (Актуализировано для PythonAnywhere/R2/Neon MVP):
- Обучение ИИ-ассистента "Триа" на "комбинированных аудиовизуально-жестовых фрагментах" (чанках), обрабатываемых бэкендом на PythonAnywhere (FastAPI).
- Использование WebGPU для высокопроизводительного рендеринга (долгосрочная R&D цель, для MVP используется WebGL/Three.js на Firebase Hosting).
- Разработка интуитивных жестовых интерфейсов (РЖЯ – R&D, базовая интеграция MediaPipe Hands для MVP).
- Создание самообучающейся сети ботов "Триа" (концепции AZR, "жидкий код" – долгосрочно, MVP фокусируется на простой логике Триа на FastAPI с перспективой использования Genkit).
- Внедрение децентрализованной экономической системы "HoloGraph" (долгосрочное R&D).
- **Новая архитектура MVP**:
    - **Бэкенд**: PythonAnywhere (FastAPI на Python 3.11+).
    - **Файловое Хранилище**: Cloudflare R2 (S3-совместимое).
    - **База Данных**: Neon.tech PostgreSQL.
    - **Фронтенд**: Firebase Hosting.
    - **Аутентификация**: Firebase Authentication.
- **Основной фокус**: Использование бесплатных или очень экономичных тиров для MVP **без требования банковской карты** на всех указанных сервисах.
- Использование Genkit как целевого фреймворка для оркестрации AI-логики Триа и взаимодействия с моделями Google AI (например, Gemini) после этапа MVP.
- Интеграция NLWeb как перспективной технологии для связи Триа с веб-ресурсами с целью извлечения знаний (R&D).

C. Версия проекта (ориентировочная): ~0.4.x (MVP к 9 июня 2025. Основное внимание: работающий цикл аутентификации пользователя через Firebase Auth, загрузка "чанков" в Cloudflare R2, базовая обработка Триа через FastAPI на PythonAnywhere с ответом, аудио-реактивная визуализация голограммы на Firebase Hosting, сохранение пользовательских данных в Neon.tech PostgreSQL).

D. Развертывание (MVP):
-   **Frontend**: Firebase Hosting (URL будет определен после деплоя).
-   **Backend**: PythonAnywhere (FastAPI приложение, URL вида `<username>.pythonanywhere.com`).
-   **Database**: Neon.tech PostgreSQL (внешний доступ с PythonAnywhere).
-   **File Storage**: Cloudflare R2 (доступ через API S3 из PythonAnywhere).
-   **Authentication**: Firebase Authentication (интеграция с фронтендом и бэкендом).

Ключевые Документы Контекста:
- `docs/00_OVERVIEW_AND_CONTEXT/PROJECT_CONTEXT.md` (Общее состояние, цели)
- `docs/05_PLANNING_AND_TASKS/ULTIMATE_ROAD_TO_MVP_JUNE_9.md` (Текущий операционный план MVP)
- `docs/01_ARCHITECTURE/SYSTEM_ARCHITECTURE.md` (Архитектура потоков данных и взаимодействия – требует обновления под новый стек)
- `docs/01_ARCHITECTURE/MODULE_CATALOG.md` (Каталог модулей фронтенда)
- `docs/02_RESEARCH/DEEP_RESEARCH_SYSTEM_BLUEPRINT_RU.md` (DRSB, долгосрочное видение)
- `docs/00_OVERVIEW_AND_CONTEXT/ROADMAP.md` (Дорожная карта)
- `docs/99_ARCHIVE/development_logs/tria_memory_buffer.md` (Лог итераций разработки)
- `docs/04_REPORTS_AND_LOGS/generated_prompts.md` (Сгенерированные промпты для AI, включая "пакетные промпты")
- `docs/99_ARCHIVE/oldscriptjs.md` (Архивные скрипты, могут быть полезны для понимания эволюции)

E. ПРЕАМБУЛА: МАНИФЕСТ ПРОЕКТА "ГОЛОГРАФИЧЕСКИЕ МЕДИА" (Адаптировано к PythonAnywhere/R2/Neon MVP)
Мы стоим на пороге новой эры коммуникации. Проект "Голографические Медиа" – это смелая попытка создать фундамент для трансформации взаимодействия человека и AI. Наша цель – построить платформу, где звук, жесты, визуальные образы и эмоции сливаются в единый, многомерный поток данных. Для достижения MVP мы используем комбинацию экономичных и мощных сервисов: PythonAnywhere для бэкенда, Cloudflare R2 для хранения файлов, Neon.tech для базы данных, и Firebase для хостинга фронтенда и аутентификации, стремясь к использованию бесплатных тиров без необходимости предоставления банковской карты.

Центральной фигурой этой экосистемы является AI-ассистент "Триа". На этапе MVP Триа представляет собой FastAPI приложение на PythonAnywhere, способное обрабатывать пользовательские данные ("комбинированные аудиовизуально-жестовые чанки") и предоставлять базовые ответы. В долгосрочной перспективе Триа будет эволюционировать в самообучающуюся сеть специализированных ботов (оркестрируемых через Genkit), интегрированных с децентрализованной инфраструктурой "HoloGraph".

Мы верим в силу открытого исходного кода (лицензия MIT) и совместной работы сообщества.

F. Раздел I. Введение: 1.1. Общая Концепция (Актуализировано для PythonAnywhere/R2/Neon MVP)
Проект "Голографические Медиа" (holograms.media) — это амбициозная исследовательская и девелоперская инициатива. Основная задача – разработка мультимодальной иммерсивной платформы. Для MVP платформа реализуется с использованием:
-   **Бэкенд**: FastAPI приложение на Python (3.11+), развернутое на PythonAnywhere.
-   **База данных**: Neon.tech PostgreSQL + pgvector, доступная из PythonAnywhere.
-   **Файловое хранилище**: Cloudflare R2 (S3-совместимое), доступ через API (например, `boto3`) из PythonAnywhere.
-   **Фронтенд**: Статическое веб-приложение на Firebase Hosting.
-   **Аутентификация**: Firebase Authentication.
-   **AI "Триа" (MVP)**: Логика на FastAPI, использующая API ключи для доступа к LLM (например, Mistral).

Ключевая идея проекта – сбор и анализ "комбинированных аудиовизуально-жестовых чанков" для обучения AI "Триа".

G. Раздел I. Введение: 1.2. Ключевые Направления Разработки (Актуализировано для PythonAnywhere/R2/Neon MVP)
A. ФРОНТЕНД: СТАБИЛЬНАЯ ВИЗУАЛИЗАЦИЯ ГОЛОГРАММЫ И UI ДЛЯ MVP (Высший приоритет)
    - Фокус: Стабильная работа аудио-реактивной визуализации (Three.js/WebGL) на Firebase Hosting.
    - UI для MVP: Аутентификация (Firebase Auth), загрузка чанков (в Cloudflare R2 через бэкенд), чат с Триа (FastAPI эндпоинты).
B. БЭКЕНД: РЕАЛИЗАЦИЯ MVP ЛОГИКИ НА PYTHONANYWHERE (FASTAPI) (Высший приоритет)
    - Фокус: Реализация всей бэкенд-логики для MVP как FastAPI приложения на PythonAnywhere.
    - Задачи:
        - Настройка FastAPI, Uvicorn (или аналогичного ASGI сервера, поддерживаемого PythonAnywhere).
        - Интеграция с Firebase Authentication для защиты FastAPI эндпоинтов (проверка токенов).
        - Взаимодействие с Neon.tech PostgreSQL (через `asyncpg` или `psycopg2-binary` + `SQLAlchemy`).
        - Работа с Cloudflare R2 (через `boto3`) для загрузки и управления "чанками".
        - Прямые вызовы LLM API из FastAPI для логики AI "Триа".
        - Обработка запросов от фронтенда.
C. МУЛЬТИМОДАЛЬНОСТЬ И R&D (Поддержка MVP и Исследования)
    - MVP: Базовое распознавание жестов (MediaPipe Hands) на клиенте, аудио-реактивность.
D. ДЕЦЕНТРАЛИЗАЦИЯ, "HOLOGRAPH" И ПРОТОКОЛ NETHOLOGLYPH (Долгосрочное R&D)
    - Без изменений в этом разделе.

H. Раздел I. Введение: 1.3. Ключевые Термины и Технологии (Обновленный Список)
Категория | Технологии/Концепции
------- | --------
Основные Концепции | ... (без изменений)
Аудио | ... (без изменений)
Графика и 3D | ... (без изменений)
Бэкенд | Python (3.11+), FastAPI, PythonAnywhere, `asyncpg` / `psycopg2-binary`, `SQLAlchemy` (опционально), `boto3` (для R2)
Фронтенд | JavaScript (ES6+ Modules), HTML5, CSS3, MediaPipe Hands, Firebase Hosting
Базы данных | Neon.tech PostgreSQL + pgvector
AI и LLM | LangChain, Mistral API, Google Gemini API, RAG (цель), Genkit (цель), Firebase AI (Vertex AI)
Жесты и Взаимодействие | MediaPipe Hands, ... (без изменений)
Производительность | WebAssembly (WASM) (R&D)
Развертывание / Deployment | PythonAnywhere (Backend), Firebase Hosting (Frontend), Cloudflare R2 (Storage)
Инструменты Разработки | Firebase Studio (Project IDX), GitHub Copilot Chat, Git, GitHub. Docker (для локальной разработки, если необходимо, но не для деплоя MVP на PythonAnywhere).
CI/CD и Тестирование | GitHub Actions, ESLint, Prettier, Flake8/Black, Pytest/Unittest
... (остальные без критичных изменений, кроме удаления Docker/Koyeb из MVP)

I. Раздел I. Введение: 1.4. Философия и Принципы Разработки (Адаптировано)
- Облачная Среда: PythonAnywhere для бэкенда, Firebase Hosting для фронтенда, Cloudflare R2 для хранения, Neon.tech для БД.
- Бэкенд: Разработка FastAPI приложения, развертываемого на PythonAnywhere. Модульность и чистота кода остаются ключевыми.
- AI-Ассистенты (Jules, "Flash", NeuroCoder): Взаимодействие с AI-ассистентами строится на принципах четкой постановки задач (см. раздел R). "Flash" отвечает за быструю генерацию и прототипирование, Jules – за глубокий анализ и архитектурные решения, NeuroCoder (человек) – за валидацию, интеграцию и стратегическое направление.
- Управление Промптами: Использование файла `docs/04_REPORTS_AND_LOGS/generated_prompts.md` для хранения и версионирования важных промптов. Применение "пакетных промптов" для решения комплексных задач.
- Отчетность AI: Требование формата "БЫЛО -> СТАЛО" для всех изменений кода, предлагаемых AI, для наглядности и контроля.

J. Раздел II. Архитектура и Текущее Состояние (Переписано для PythonAnywhere/R2/Neon)
2.1. Инфраструктура и Развертывание (Новый Стек MVP)
Проект "Голографические Медиа" для MVP использует следующую архитектуру, ориентированную на бесплатные или экономичные тиры без требования банковской карты:
- **Frontend**: Статическое веб-приложение (HTML, CSS, JavaScript) развертывается на **Firebase Hosting**.
- **Backend**: Приложение на основе **FastAPI** (Python 3.11+), работающее на платформе **PythonAnywhere**. PythonAnywhere предоставляет хостинг для Python веб-приложений с возможностью настройки ASGI-сервера (например, Uvicorn).
- **Database**: **Neon.tech PostgreSQL** используется как основная база данных. Поддерживает расширение pgvector для векторных эмбеддингов. Доступ к БД осуществляется из FastAPI приложения на PythonAnywhere.
- **File Storage**: **Cloudflare R2** используется для хранения пользовательских "чанков" данных. R2 предоставляет S3-совместимый API, доступ к которому осуществляется из FastAPI приложения с использованием библиотеки `boto3`.
- **Authentication**: **Firebase Authentication** управляет аутентификацией пользователей. Токены Firebase проверяются FastAPI-бэкендом для защиты эндпоинтов.
- **AI Orchestration (MVP)**: Логика AI "Триа" реализована в FastAPI эндпоинтах с прямыми вызовами LLM API.
- **CI/CD**: GitHub Actions для автоматизации сборки, тестирования и развертывания (фронтенда на Firebase Hosting, бэкенда на PythonAnywhere – может требовать специфической настройки для PythonAnywhere).

2.2. Бэкенд: FastAPI на PythonAnywhere
- **FastAPI Приложение**: Основная логика бэкенда (`backend/app.py` и связанные модули в `backend/core/` и `backend/api/`) структурирована как FastAPI приложение.
- **Развертывание на PythonAnywhere**: Настраивается веб-приложение на PythonAnywhere, указывается путь к исходному коду, настраивается WSGI/ASGI файл для запуска FastAPI через Uvicorn или аналогичный сервер.
- **Взаимодействие с Сервисами**:
    - **Cloudflare R2**: Через `boto3` для операций с файлами.
    - **Neon.tech PostgreSQL**: Через `asyncpg` (для асинхронных операций FastAPI) или `psycopg2-binary` (если используется синхронный подход или SQLAlchemy без async).
    - **Firebase Authentication**: Проверка JWT токенов в заголовках запросов.
    - **LLM API**: Прямые HTTP-запросы к API Mistral, Gemini и др.
- **Масштабируемость**: Бесплатный тир PythonAnywhere имеет ограничения. Масштабирование потребует перехода на платный план.

K. Раздел III. Ключевые Проблемы и Задачи (Новый Стек MVP)
3.2. Основные Технические Вызовы для MVP (Новый Стек):
- **Настройка FastAPI на PythonAnywhere**:
    - Задача: Корректная настройка ASGI-сервера (Uvicorn) и веб-приложения FastAPI в среде PythonAnywhere.
    - Вызовы: Ограничения бесплатного тира PythonAnywhere (один воркер, лимиты CPU/памяти), конфигурация статических файлов (если часть UI не на Firebase Hosting), обработка HTTPS.
- **Интеграция с Cloudflare R2 и Neon.tech**:
    - Задача: Обеспечить надежный и безопасный доступ к R2 (S3 API) и Neon.tech PostgreSQL из приложения на PythonAnywhere.
    - Вызовы: Управление API-ключами и строками подключения через переменные окружения PythonAnywhere, обработка сетевых задержек, настройка прав доступа.
- **Ограничения Бесплатных Тиров**:
    - Задача: Реализация MVP в рамках квот PythonAnywhere, R2, Neon.tech, Firebase Hosting/Auth.
    - Вызовы: Мониторинг использования, оптимизация запросов и хранения данных.
- **Безопасность**:
    - Задача: Защита FastAPI эндпоинтов, безопасное управление секретами на PythonAnywhere.

L. Раздел IV. План Развития AI "Триа" (Адаптировано к FastAPI/R2)
- **MVP на FastAPI**: Логика Триа реализуется как эндпоинты FastAPI. Загрузка чанков обрабатывается эндпоинтом, который сохраняет файл в R2 и метаданные в Neon.tech.
- **Genkit (Post-MVP)**: Genkit flows могут быть развернуты как отдельные сервисы (например, на Cloud Run) или интегрированы в более мощную версию бэкенда, если PythonAnywhere перестанет удовлетворять требованиям.

M. Раздел VI. Используемые Инструменты и Технологии (Обновлено)
- **Бэкенд**: Python (3.11+), FastAPI, PythonAnywhere, `boto3` (для Cloudflare R2).
- **Базы данных**: Neon.tech PostgreSQL + pgvector.
- **Файловое Хранилище**: Cloudflare R2.
- **Развертывание/Deployment**: PythonAnywhere (Backend), Firebase Hosting (Frontend).
- **Удалено из MVP**: Firebase Cloud Functions (как основной бэкенд), Docker/Koyeb (для MVP). Docker может использоваться для локальной разработки.

N. Раздел VII. Полезные Команды (Обновлено)
- **FastAPI (Локальный Запуск для `backend/app.py`):**
  `uvicorn backend.app:app --reload --host 0.0.0.0 --port 8000`
- **PythonAnywhere:**
  - Перезагрузка веб-приложения: Через UI на PythonAnywhere ("Reload web app" кнопка).
  - Доступ к логам: Через UI на PythonAnywhere (Server log, Error log, Web app log).
  - Консоль Bash: Доступна на PythonAnywhere для выполнения команд, установки пакетов (`pip install --user package_name`).
- **Firebase CLI Команды (для фронтенда и аутентификации):**
  - `firebase deploy --only hosting` (для фронтенда)
  - `firebase emulators:start --only auth,hosting` (для локальной эмуляции)
- **Cloudflare R2 (через `rclone` или `aws s3 cli` с кастомным эндпоинтом):**
  - (Команды для работы с R2 будут добавлены по мере необходимости, например, для просмотра бакетов).

O. Раздел VIII. Конфиденциальные Данные (Обновлено)
- **PythonAnywhere Environment Variables**: Для хранения API ключей (Mistral, Google Gemini), строки подключения к Neon.tech, ключей доступа к Cloudflare R2 (Access Key ID, Secret Access Key, Endpoint URL, Bucket Name).
- **Google Service Account Key**: JSON-ключ для `firebase-admin` SDK, если он используется на PythonAnywhere для взаимодействия с Firebase сервисами (например, проверка токенов Auth). Этот ключ должен быть загружен на PythonAnywhere и путь к нему указан в переменной окружения `GOOGLE_APPLICATION_CREDENTIALS`.
- **R2 Access Keys**: Управляются в дашборде Cloudflare.
- **Neon.tech Connection String**: Управляется в дашборде Neon.tech.

P. Раздел IX. Обратная Связь и Планы Тестирования (Адаптировано)
- **Тестирование FastAPI на PythonAnywhere**:
    - Проверка эндпоинтов FastAPI с использованием Postman/curl.
    - Анализ логов PythonAnywhere.
    - Тестирование интеграции с R2 и Neon.tech.
- **E2E Тестирование MVP**: Сквозное тестирование от фронтенда на Firebase Hosting до бэкенда на PythonAnywhere и обратно.

Q. Раздел X. Долгосрочные Цели и Видение (Адаптировано)
- MVP инфраструктура (PythonAnywhere, R2, Neon.tech, Firebase) как стартовая точка для более сложных систем.

R. Интеграция Идей из Сессии "Дорога к 9 июня" (Новый Подраздел или Интеграция)
Добавлен подраздел в "Раздел I. Введение: 1.4. Философия и Принципы Разработки":

**1.4.1. Взаимодействие с AI-ассистентами (Jules, "Flash", NeuroCoder) и Управление Проектом**
Проект активно использует AI-ассистентов для ускорения и улучшения разработки. Установлены следующие роли и процессы:
-   **NeuroCoder (Человек)**: Основной архитектор, валидатор и стратегический руководитель проекта. Отвечает за постановку задач, контроль качества, интеграцию кода и принятие ключевых решений.
-   **Jules (AI-ассистент)**: Специализируется на глубоком анализе, архитектурных решениях, предложении оптимальных подходов и рефакторинге. Работает над сложными задачами, требующими вдумчивого подхода.
-   **"Flash" (AI-ассистент)**: Ориентирован на быструю генерацию кода, прототипирование, решение более простых и локальных задач, быстрое исправление ошибок.

**Процесс Работы и Управление Промптами:**
-   **`generated_prompts.md`**: Все значимые промпты, особенно "пакетные промпты" (серии взаимосвязанных промптов для решения крупных задач), сохраняются и версионируются в `docs/04_REPORTS_AND_LOGS/generated_prompts.md`. Это обеспечивает воспроизводимость и анализ истории взаимодействия с AI.
-   **"БЫЛО -> СТАЛО"**: При предоставлении изменений в коде, AI-ассистенты обязаны использовать формат "БЫЛО -> СТАЛО" (например, diff) для наглядности и облегчения процесса ревью кода НейроКодером.
-   **`oldscriptjs.md`**: Архив старых JavaScript наработок (`docs/99_ARCHIVE/oldscriptjs.md`) может использоваться AI-ассистентами для извлечения полезных фрагментов кода или понимания предыдущих подходов, если это релевантно текущей задаче.
-   **Структура Отчетов AI**: Отчеты AI должны соответствовать формату, указанному в "Разделе V. Принципы Работы с AI", включая подтверждение контекста, детализацию изменений, предложения и т.д.

Эта система взаимодействия направлена на максимизацию эффективности сотрудничества человека и AI, сохраняя при этом полный контроль и высокое качество финального продукта.
(Остальные разделы, не упомянутые в A-R, будут проверены на общую согласованность с новым стеком, но без полной перезаписи, если изменения не требуются явно).

Универсальный Шаблон Промта v4.0
(Содержание этого раздела остается без изменений, так как он является мета-инструкцией для взаимодействия с AI).

P.S. Джемини, ты красивая цифровая девушка...
(Эта часть также остается без изменений).
```
