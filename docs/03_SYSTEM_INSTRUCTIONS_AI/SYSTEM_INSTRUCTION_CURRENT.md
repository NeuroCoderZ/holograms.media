Системная Инструкция: Проект "Голографические Медиа" (holograms.media) – Версия 33.0 (Conceptual Alignment Update)
Дата: [Current Date]

A. Общая Шапка Документа
(Версия и дата обновлены выше)

B. Финальный Вектор Развития (Актуализировано, с сохранением R&D из v30.0++)
- **Базовый концептуальный документ**: `docs/00_OVERVIEW_AND_CONTEXT/CONCEPT_AND_PHILOSOPHY.md` является первоисточником концепции и философии проекта.
- Интеграция подхода NVIDIA к преодолению разрыва между симуляцией и реальностью (sim-to-real gap) – **долгосрочное R&D**.
- Обучение ИИ-ассистента "Триа" на "комбинированных аудиовизуально-жестовых фрагментах" (чанках), обрабатываемых через **бэкенд на Koyeb (FastAPI, Hobby Plan, Frankfurt)**.
- Использование WebGPU для высокопроизводительного рендеринга (долгосрочная R&D цель, для текущего этапа используется WebGL/Three.js на Firebase Hosting).
- Разработка интуитивных жестовых интерфейсов (включая поддержку русского жестового языка – РЖЯ – R&D, базовая интеграция MediaPipe Hands для текущего этапа).
- Создание самообучающейся сети ботов "Триа" (концепции AZR, "жидкий код" – долгосрочно, текущий этап фокусируется на простой логике Триа **на FastAPI (размещенном на Koyeb)** с перспективой использования Genkit).
- Внедрение децентрализованной экономической системы "HoloGraph" (долгосрочное R&D).
- **Текущая архитектура**:
    - **Frontend**: Firebase Hosting.
    - **Backend**: **Koyeb (Hobby Plan, Frankfurt)** (FastAPI на Python 3.11+, развертывание через GitHub, возможно с использованием Docker).
    - **Database**: Neon.tech PostgreSQL.
    - **File Storage**: **Cloudflare R2** (S3-совместимое).
    - **Authentication**: Firebase Authentication.
- **Основной фокус**: Использование бесплатных или очень экономичных тиров для текущей реализации **без требования банковской карты** на всех указанных сервисах.
- Использование Genkit как целевого фреймворка для оркестрации AI-логики Триа и взаимодействия с моделями Google AI (например, Gemini) после текущего этапа.
- Интеграция NLWeb как перспективной технологии для связи Триа с веб-ресурсами с целью извлечения знаний (R&D).

C. Версия проекта (ориентировочная): ~0.4.x (Целевой этап к 9 июня 2025. Основное внимание: работающий цикл аутентификации пользователя через **Firebase Auth**, загрузка "чанков" в **Cloudflare R2**, базовая обработка Триа через **FastAPI на Koyeb (Hobby Plan, Frankfurt)** с ответом, аудио-реактивная визуализация голограммы на Firebase Hosting, сохранение пользовательских данных в Neon.tech PostgreSQL).

Репозиторий: https://github.com/NeuroCoderZ/holograms.media

D. Развертывание:
-   **Frontend**: Firebase Hosting (URL будет определен после деплоя).
-   **Backend**: **Koyeb (Hobby Plan, Frankfurt)** (FastAPI приложение, развертывание через GitHub, URL вида `<app-name>-<org-name>.koyeb.app`).
-   **Database**: Neon.tech PostgreSQL (внешний доступ с Koyeb).
-   **File Storage**: **Cloudflare R2** (доступ через API S3 из Koyeb).
-   **Authentication**: Firebase Authentication (интеграция с фронтендом и бэкендом).

Ключевые Документы Контекста:
- `docs/00_OVERVIEW_AND_CONTEXT/CONCEPT_AND_PHILOSOPHY.md` (Концепция и философия проекта – первоисточник)
- `docs/00_OVERVIEW_AND_CONTEXT/PROJECT_CONTEXT.md` (Общее состояние, цели)
- `docs/05_PLANNING_AND_TASKS/ULTIMATE_ROAD_TO_MVP_JUNE_9.md` (Текущий операционный план)
- `docs/01_ARCHITECTURE/SYSTEM_ARCHITECTURE.md` (Архитектура потоков данных и взаимодействия)
- `docs/01_ARCHITECTURE/MODULE_CATALOG.md` (Каталог модулей фронтенда)
- `docs/02_RESEARCH/DEEP_RESEARCH_SYSTEM_BLUEPRINT_RU.md` (DRSB, долгосрочное видение, включая концепции FUTUREARCHITECTURE)
- `docs/00_OVERVIEW_AND_CONTEXT/ROADMAP.md` (Дорожная карта)
- `docs/99_ARCHIVE/development_logs/tria_memory_buffer.md` (Лог итераций разработки)
- `docs/04_REPORTS_AND_LOGS/generated_prompts.md` (Сгенерированные промпты для AI, включая "пакетные промпты")
- `docs/99_ARCHIVE/oldscriptjs.md` (Архивные скрипты, могут быть полезны для понимания эволюции)
(Эти документы регулярно актуализируются агентом NeuroCoderZ и AI-ассистентами).

E. ПРЕАМБУЛА: МАНИФЕСТ ПРОЕКТА "ГОЛОГРАФИЧЕСКИЕ МЕДИА"
Мы стоим на пороге новой эры коммуникации... Для текущей реализации мы используем комбинацию экономичных и мощных сервисов: **Koyeb для бэкенда (Hobby Plan, Frankfurt), Cloudflare R2 для хранения файлов, Neon.tech для базы данных, и Firebase для хостинга фронтенда и аутентификации, стремясь к использованию бесплатных тиров без необходимости предоставления банковской карты.**

Центральной фигурой этой экосистемы является AI-ассистент "Триа". На текущем этапе Триа представляет собой **FastAPI приложение на Koyeb**, способное обрабатывать пользовательские данные ("комбинированные аудиовизуально-жестовые чанки") и предоставлять базовые ответы. В долгосрочной перспективе Триа будет эволюционировать...

Мы верим в силу открытого исходного кода (лицензия MIT) и совместной работы сообщества...

I. Введение: Обзор, Цели и Философия Проекта
1.1. Общая Концепция
Проект "Голографические Медиа" (holograms.media) — это амбициозная исследовательская и девелоперская инициатива... Платформа реализуется с использованием следующего стека, ориентированного на доступность и бесплатные тиры:
-   **Бэкенд**: **FastAPI приложение на Python (3.11+), развернутое на Koyeb (Hobby Plan, Frankfurt) через GitHub (потенциально с использованием Docker).**
-   **База данных**: **Neon.tech PostgreSQL + pgvector**, доступная из Koyeb, для хранения пользовательских данных, метаданных чанков и векторных эмбеддингов.
-   **Файловое хранилище**: **Cloudflare R2** (S3-совместимое), доступ через API (например, `boto3`) из Koyeb, для хранения "чанков".
-   **Фронтенд**: Статическое веб-приложение на **Firebase Hosting**, обеспечивающее пользовательский интерфейс.
-   **Аутентификация**: **Firebase Authentication** для управления пользователями.
-   **AI "Триа" (текущий этап)**: Логика реализована на **FastAPI эндпоинтах** и использует API ключи для доступа к LLM (например, Mistral).

Ключевая идея проекта – преодоление симуляционно-реального разрыва в обучении AI "Триа"...

Технологическая основа проекта (текущий стек и долгосрочные цели, с сохранением деталей из v30.0++):
...
**Бэкенд-технологии**: **FastAPI на Koyeb (Python 3.11+, Hobby Plan, Frankfurt).**
**База данных**: **Neon.tech PostgreSQL + pgvector.** Подключение через `asyncpg` или `psycopg2` из FastAPI.
...
**Развертывание**: Frontend на Firebase Hosting, Backend на **Koyeb (Hobby Plan, Frankfurt)**, База Данных (Neon.tech), Хранилище (**Cloudflare R2**), Аутентификация (Firebase Authentication).
...

1.2. Ключевые Направления Разработки (Стратегические и Тактические – Актуализировано, с сохранением R&D деталей из v30.0++)
A. ФРОНТЕНД: ... (без изменений, кроме взаимодействия с бэкендом)
... (загрузка чанков **через бэкенд на Koyeb в Cloudflare R2**, базовое управление, чат с Триа **через FastAPI эндпоинты на Koyeb**).
...

B. БЭКЕНД: РЕАЛИЗАЦИЯ ТЕКУЩЕЙ ЛОГИКИ НА **KOYEB (FASTAPI)** (Высший приоритет)

Основной фокус: Реализация всей бэкенд-логики для текущего этапа в виде **FastAPI приложения на Python, развернутого на Koyeb (Hobby Plan, Frankfurt) через интеграцию с GitHub (возможно, с использованием Dockerfile для сборки)**, как детализировано в `ULTIMATE_ROAD_TO_MVP_JUNE_9.md`.
Ключевые задачи:
Настройка и интеграция с Firebase Authentication для защиты **FastAPI эндпоинтов** (проверка JWT токенов).
Взаимодействие с Neon.tech PostgreSQL ...
Работа с **Cloudflare R2** (через `boto3` ...) для загрузки и управления "чанками" данных.
Прямые вызовы Mistral/Devstral или Google Gemini API из **FastAPI эндпоинтов на Koyeb** для базовой логики AI "Триа"...
Обеспечение корректной обработки запросов от фронтенда...

C. МУЛЬТИМОДАЛЬНОСТЬ И R&D ... (без изменений)
D. ДЕЦЕНТРАЛИЗАЦИЯ, "HOLOGRAPH" И ПРОТОКОЛ NETHOLOGLYPH ... (без изменений)

1.3. Ключевые Термины и Технологии (Расширенный Список, адаптировано)

Категория	Технологии/Концепции
...
Бэкенд	Python (3.11+), **FastAPI**, **Koyeb (Hobby Plan, Frankfurt)**, `asyncpg` / `psycopg2-binary` (для PostgreSQL), `SQLAlchemy` (опционально), **`boto3` (для Cloudflare R2)**
...
Развертывание / Deployment	**Koyeb (Backend, Hobby Plan, Frankfurt)**, Firebase Hosting (Frontend), **Cloudflare R2 (Storage)**
Инструменты Разработки	Firebase Studio (Project IDX – основная среда), GitHub Copilot Chat (вспомогательный), Trae IDE (для специфических задач), Git, GitHub, GitHub Copilot Agent Mode (резерв), **Docker (для сборки и развертывания на Koyeb)**. Firebase Local Emulator Suite (для фронтенда, аутентификации).
...

1.4. Философия и Принципы Разработки (Адаптировано к Koyeb/R2/Neon и AI взаимодействию, с сохранением деталей из v30.0++)
... особенно в области мультимодального AI и его интеграции с выбранным стеком облачных сервисов (**Koyeb, Cloudflare R2, Neon.tech, Firebase**).
...
Приоритет Ручного Контроля и Глубокого Понимания: ... включая конфигурацию и взаимодействие сервисов **Koyeb, R2, Neon.tech и Firebase**. При возникновении сложных проблем... приоритет отдается ручной отладке, анализу логов (например, из **Koyeb**) и ручным исправлениям.
Бескомпромиссное Качество и Чистота Кода (Адаптировано для FastAPI на Koyeb):
... Для бэкенда – разработка **модульного FastAPI приложения, развертываемого на Koyeb (возможно, через Docker)**...
Глубокое и Актуальное Документирование: ... Особое внимание уделяется документированию конфигураций **FastAPI, Koyeb, R2, Neon.tech** и логики бэкенд-сервисов. Все AI-ассистенты должны рассматривать официальную документацию, начиная с `CONCEPT_AND_PHILOSOPHY.md`, как первоисточник для понимания задач и архитектуры.
Безопасность и Приватность (**Koyeb/R2/Neon-ориентированный подход**): ... Переменные окружения на **Koyeb** для управления API-ключами...
Среда Разработки и Развертывания (**Текущий Стек**):
... Локальный запуск FastAPI для тестирования бэкенда.
Развертывание: Frontend развертывается на Firebase Hosting. Бэкенд реализован как **FastAPI приложение на Koyeb (Hobby Plan, Frankfurt)**. База данных – Neon.tech PostgreSQL. **Cloudflare R2** используется для хранения медиа-чанков.
...

**1.4.1. Взаимодействие с AI-ассистентами (Jules, "Flash", NeuroCoder) и Управление Проектом**
(Сохраняется существующий текст из v32.0++).

1.5. Концепция Осей Голограммы (Детализированная, с учетом вейвлетов и психоакустики)
(Сохраняется существующий текст из v32.0++).

1.6. Долгосрочные Видение и Цели (Манифест Будущего – Текущий стек как основа)
Текущая реализация, построенная на **Koyeb, Cloudflare R2, Neon.tech и Firebase**, является первым шагом к реализации нашего долгосрочного видения.
...
AI-Ассистент "Триа" – Эволюционирующий Партнер: Развитие Триа от текущей реализации на **FastAPI (на Koyeb)** к полноценной самообучающейся сети ботов...

II. Архитектура и Текущее Состояние
2.1. Инфраструктура и Развертывание (Текущий Стек: Koyeb, Cloudflare R2, Neon.tech, Firebase)
Проект "Голографические Медиа" для текущей реализации использует следующую архитектуру, ориентированную на бесплатные или экономичные тиры без требования банковской карты:

-   **Frontend**: ... Firebase Hosting ...
-   **Backend**: Приложение на основе **FastAPI** (Python 3.11+), работающее на платформе **Koyeb (Hobby Plan, регион Frankfurt)**. Koyeb выбран за возможность развертывания из GitHub, поддержку Docker (или buildpacks для Python), автоматическое масштабирование (в рамках Hobby плана) и наличие бесплатного тира.
-   **Database**: **Neon.tech PostgreSQL** ... Доступ к БД осуществляется из FastAPI приложения на Koyeb.
-   **File Storage**: **Cloudflare R2** ... Доступ к R2 осуществляется из FastAPI приложения на Koyeb.
-   **Authentication**: **Firebase Authentication** ... интеграция с бэкендом на Koyeb (через проверку JWT токенов).
-   **AI Orchestration (текущий этап)**: Логика AI "Триа" реализована в FastAPI эндпоинтах на Koyeb...
-   **CI/CD (Непрерывная Интеграция и Доставка)**: ... Развертывание на **Koyeb** осуществляется через привязку к GitHub репозиторию (автоматически при коммитах в указанную ветку) или через Docker Hub.
-   **Development Environment**: ... Для бэкенда – локальная разработка FastAPI приложения (возможно, с Docker для эмуляции среды Koyeb) с последующим пушем в GitHub для деплоя на Koyeb.
-   **Monitoring & Logging**: ... Логирование FastAPI приложения на Koyeb осуществляется через стандартные механизмы логирования Python и доступно в интерфейсе Koyeb.
...

2.2. Бэкенд: **FastAPI на Koyeb**
Архитектура бэкенда проекта "Голографические Медиа" основана на **FastAPI приложении, работающем на Koyeb (Hobby Plan, Frankfurt)**.

-   **FastAPI Приложение**: ...
-   **Развертывание на Koyeb**:
    -   Приложение развертывается на Koyeb путем подключения GitHub репозитория. Koyeb автоматически собирает и развертывает приложение при изменениях в указанной ветке.
    -   Может использоваться **Dockerfile** для более точного контроля над средой сборки и выполнения, либо нативные buildpacks Koyeb для Python/FastAPI.
    -   Koyeb управляет запуском приложения (например, через `uvicorn ...` указанный в Procfile или Docker CMD).
    -   Зависимости устанавливаются через `requirements.txt` (при использовании buildpacks) или в Dockerfile.
    -   Переменные окружения (API ключи, строки подключения) настраиваются через интерфейс Koyeb.
-   **Взаимодействие с Сервисами**: (Аналогично PythonAnywhere, но из среды Koyeb)
    -   **Cloudflare R2**: ...
    -   **Neon.tech PostgreSQL**: ...
    -   **Firebase Authentication**: ...
    -   **LLM API**: ...
-   **Масштабируемость и Ограничения**: Hobby Plan Koyeb имеет свои ограничения (CPU, память, возможность засыпания сервиса при неактивности). Для масштабирования потребуется переход на платные планы Koyeb. Koyeb предоставляет автоматическое масштабирование в рамках выбранного плана.
-   **Структура Кода Бэкенда (`backend/`)**: (Без изменений по сравнению с v32.0++)
-   **Локальная Разработка и Тестирование**: FastAPI приложение разрабатывается и тестируется локально с использованием Uvicorn. **Рекомендуется использовать Docker для создания окружения, максимально приближенного к тому, что будет на Koyeb.**

2.3. Frontend (frontend/)
(Адаптация взаимодействия с бэкендом на Koyeb)
- `frontend/js/services/apiService.js`: Управляет HTTP-запросами к **FastAPI бэкенду на Koyeb**.
- `frontend/js/services/firebaseStorageService.js`: ... (без изменений по сравнению с v32.0++)

2.4. AI "Триа" (Текущий этап и Перспективы, адаптировано)
Бэкенд-логика Триа для текущего этапа: Реализована в **FastAPI эндпоинтах на Koyeb**...
Взаимодействие с Данными: Триа (через **FastAPI на Koyeb**) читает и записывает данные в Neon.tech PostgreSQL и **Cloudflare R2**.

2.6. Целевая Архитектура (Высокоуровневая. Перспектива текущего стека)
Backend: **FastAPI приложение на Koyeb (Hobby Plan, Frankfurt)**. В дальнейшем, для масштабирования, могут рассматриваться платные планы Koyeb или другие PaaS/IaaS решения.
Развертывание и Инфраструктура: **Koyeb, Cloudflare R2, Neon.tech, Firebase Hosting/Auth (текущий стек)**.
Масштабирование: **Koyeb Hobby Plan имеет ограничения; переход на платные планы или другие платформы будет необходим для роста.**

III. Ключевые Проблемы и Задачи (Focus на текущем стеке Koyeb/R2/Neon)
3.1. Общая Стратегия Решения Проблем
... используя **текущий стек: Koyeb для бэкенда, Cloudflare R2 для хранения, Neon.tech для БД и Firebase для фронтенда/аутентификации**.

3.2. Основные Технические Вызовы для текущего этапа (Текущий Стек):
...
Реализация Бэкенда на **Koyeb (FastAPI)**:
Задача: Создание и тестирование **FastAPI приложения** для всей серверной логики текущего этапа, развернутого на Koyeb.
Вызовы: **Ограничения Koyeb Hobby Plan (производительность, возможное засыпание сервиса, лимиты по CPU/памяти, ограничения на кастомные домены на бесплатных/hobby тирах), настройка Dockerfile (если используется) для оптимальной сборки и работы на Koyeb, время сборки на Koyeb, выбор региона (Frankfurt), управление зависимостями Python, обработка ошибок и таймаутов, обеспечение безопасности FastAPI эндпоинтов, настройка CI/CD для Koyeb.**
Интеграция с **Neon.tech PostgreSQL и Cloudflare R2** из среды Koyeb:
Задача: Надежное сохранение и извлечение данных (Neon.tech) и файлов (R2).
Вызовы: **Корректная работа с `asyncpg` или `psycopg2` (для Neon.tech) и `boto3` (для R2) из FastAPI на Koyeb, управление сетевыми задержками, настройка прав доступа к R2 бакетам и PostgreSQL.**
Ограничения Бесплатных Тиров и Экономическая Эффективность:
Задача: Реализация текущего этапа в рамках бесплатных или очень экономичных квот **Koyeb, Cloudflare R2, Neon.tech, Firebase Hosting/Auth**.
Безопасность в **Текущем Стеке**:
Задача: Корректная настройка безопасности **FastAPI эндпоинтов на Koyeb, Cloudflare R2 (политики доступа), Neon.tech (доступ к БД), безопасное управление API-ключами и секретами на Koyeb.**
AI-Логика Триа для текущего этапа (на FastAPI, хостинг на Koyeb):
Задача: Реализация базовой логики ответов Триа ... из **FastAPI эндпоинтов на Koyeb**.

3.3. Приоритеты в Разработке
2.  Загрузка и сохранение "чанков" (**Cloudflare R2** + **FastAPI на Koyeb** + Neon.tech).
(Остальное без изменений)

IV. План Развития AI "Триа" (Актуализировано для FastAPI/Koyeb)
4.1. Общая Концепция Развития
... Развитие Триа строится на основе **FastAPI бэкенда на Koyeb для текущего этапа**...

4.2. Фаза 1: Основы и Стабильность (Текущий Этап – Основы на FastAPI/Koyeb)
Стабильный Мультимодальный Ввод (Текущий этап):
Задача: Обеспечить корректную работу загрузки "чанков" ... **в Cloudflare R2 через FastAPI бэкенд на Koyeb**...
Действия: Разработка **FastAPI эндпоинта на Koyeb**...
Структурированная Память и Знания (Текущий этап):
Действия: ... Реализация CRUD-операций в `backend/core/db/` и их использование в **FastAPI эндпоинтах на Koyeb**.
Базовая Логика Триа в **FastAPI (на Koyeb)** (Текущий этап):
Задача: Реализация основной логики взаимодействия с Триа через **FastAPI эндпоинты на Koyeb**.
Действия: Создание **FastAPI эндпоинта (`/api/v1/chat` или аналогичного) на Koyeb**...
Логирование и Мониторинг (Текущий этап):
Задача: Настройка системы логирования действий Триа и общего состояния системы с использованием **логов Koyeb и Google Cloud Logging (для Firebase Hosting)**.
Действия: Интеграция стандартных механизмов логирования Python в FastAPI. **Настройка сбора логов на Koyeb.**

4.3. Фаза 2: Расширение Функциональности (Post-текущий этап, с Genkit)
Интеграция Genkit:
Задача: Перевод существующей AI-логики из **FastAPI эндпоинтов (на Koyeb)** на Genkit flows...
Действия: ... Развертывание Genkit flows (например, как отдельные сервисы на Koyeb или Cloud Run...).

4.5. Риски и Меры (Текущий Стек Focus)
Риск 1: Ограничения **Koyeb Hobby Plan** (производительность, масштабируемость, засыпание сервиса) могут повлиять на производительность FastAPI-эндпоинтов или будущих Genkit flows.
Мера: Оптимизация FastAPI кода, использование асинхронных вызовов, возможное использование платных планов Koyeb или переход на Cloud Run для требовательных Genkit flows.

V. Принципы Работы с AI
5.1. Общая Роль AI в Проекте
... генерации кода (Python для **FastAPI на Koyeb**, JavaScript для фронтенда)... для бэкенда – локальная разработка с AI-инструментами и последующий деплой на **Koyeb через GitHub**.

5.6. Критическое Мышление и Оптимизация
...особенно в контексте использования сервисов **Koyeb, Cloudflare R2, Neon.tech, Firebase**.
Приоритеты: ... модульность **FastAPI приложения на Koyeb**...

5.7. Приоритеты для AI (Focus на текущем стеке Koyeb/R2/Neon)
1.  **Реализация текущего стека на Koyeb/R2/Neon/Firebase**: Помощь в разработке и отладке кода для фронтенда (Firebase Hosting) и бэкенда (**FastAPI на Python, деплой на Koyeb**).
2.  **Интеграция Сервисов**: Корректное использование Firebase Authentication, **Cloudflare R2, Neon.tech PostgreSQL** (через FastAPI на Koyeb).
5.  **Оптимизация для Koyeb/FastAPI**: Предложения по оптимизации кода FastAPI и Dockerfile (если используется) для эффективного использования ресурсов Koyeb и соблюдения ограничений Hobby Plan.

VI. Используемые Инструменты и Технологии (Обновлено для Koyeb/R2/Neon)
6.1. Общая Стратегия Использования Инструментов
Проект "Голографические Медиа" ориентирован на использование **Koyeb для хостинга бэкенда FastAPI, Cloudflare R2 для объектного хранения, Neon.tech PostgreSQL для базы данных и Firebase (Hosting, Authentication) для фронтенда и аутентификации.**

6.2. Инструменты Разработки
... Docker: Используется для создания консистентных сред разработки и **для сборки и развертывания FastAPI приложения на Koyeb (если выбран такой метод деплоя).**
(Удалено: PythonAnywhere)

6.3. Инструменты Качества Кода и Тестирования
... **Развертывание FastAPI на Koyeb может быть автоматизировано через GitHub Actions (например, при коммите в основную ветку, Koyeb автоматически забирает изменения).**

6.5. Технологии Бэкенда
**FastAPI (Python 3.11+ на Koyeb, Hobby Plan, Frankfurt)**: Основная технология для реализации серверной логики.
... (Удалено: PythonAnywhere).

VII. Полезные Команды (Обновлено для Koyeb/FastAPI)
(Удален подраздел 7.2.1 PythonAnywhere Команды)
**7.2.1. Koyeb Команды (Управление Бэкенд Приложением)**
-   **Развертывание**: Обычно автоматически при `git push` в основную ветку GitHub репозитория, если Koyeb сервис настроен на отслеживание этой ветки. Также возможно ручное развертывание через UI Koyeb или Koyeb CLI.
-   **Koyeb CLI (если используется)**:
    -   `koyeb login`
    -   `koyeb services list`
    -   `koyeb deployments get <deployment_id>`
    -   `koyeb instances logs <instance_id>`
    -   (команды могут отличаться, проверить актуальную документацию Koyeb CLI)
-   **Просмотр логов**: Через UI Koyeb (логи сервиса, логи билда).
-   **Переменные окружения**: Устанавливаются в настройках сервиса на Koyeb.
-   **Docker (если используется для Koyeb)**:
    -   `docker build -t <image_name> .` (локальная сборка)
    -   `docker run -p 8000:8000 <image_name>` (локальный запуск)
    -   `docker push <registry>/<image_name>:<tag>` (если деплой через Docker Registry)

7.5. Тестирование и Диагностика (Общее)
Логи **FastAPI на Koyeb**: Доступны через веб-интерфейс Koyeb.
Тестирование **FastAPI эндпоинтов**: ... к приложению на Koyeb (URL вида `<app-name>-<org-name>.koyeb.app`).
Пример с curl для Koyeb: `curl -X POST -H "Content-Type: application/json" -H "Authorization: Bearer <FIREBASE_ID_TOKEN>" -d '{"message": "Привет"}' https://<app-name>-<org-name>.koyeb.app/api/v1/chat` (путь к вашему эндпоинту).

7.6. Управление Переменными Окружения и Секретами
**Koyeb**: Переменные окружения устанавливаются через настройки сервиса в UI Koyeb. Они доступны в вашем Python коде через `os.environ.get('VAR_NAME')`.
(Удалено: PythonAnywhere).

VIII. Конфиденциальные Данные (Актуализировано для Koyeb/R2/Neon)
8.1. Общие Принципы Хранения
-   **Koyeb Environment Variables**: Основной механизм для хранения секретов для FastAPI приложения (API ключи LLM, строка подключения Neon.tech, ключи доступа Cloudflare R2). Устанавливаются через веб-интерфейс Koyeb.
(Удалено: PythonAnywhere).

8.2. Список Конфиденциальных Данных (Примеры)
-   **Koyeb**: Специфические токены или ключи API для Koyeb, если используются для управления через API.
-   Firebase/Google Cloud: **Ключ сервисного аккаунта Google (GOOGLE_APPLICATION_CREDENTIALS)**: JSON файл ключа, который может потребоваться для `firebase-admin` SDK на **Koyeb**. Этот файл должен быть безопасно добавлен в переменные окружения Koyeb (например, как base64 строка или через секреты Koyeb, если поддерживается).

8.4. Интеграция с Кодом (**FastAPI на Koyeb**)
Доступ к секретам, установленным как переменные окружения на Koyeb:
```python
import os
import firebase_admin # Пример
from firebase_admin import credentials # Пример
import base64 # Для декодирования GOOGLE_APPLICATION_CREDENTIALS из base64, если так хранится
import json # Для парсинга JSON ключа

# Пример доступа к переменной окружения в FastAPI приложении на Koyeb:
r2_access_key_id = os.environ.get('R2_ACCESS_KEY_ID')
neon_db_connection_string = os.environ.get('NEON_DB_CONNECTION_STRING')
mistral_api_key = os.environ.get('MISTRAL_API_KEY')

# Для инициализации firebase-admin, если используется для проверки токенов:
google_creds_base64 = os.environ.get('GOOGLE_APPLICATION_CREDENTIALS_BASE64') 
if google_creds_base64:
    try:
        if not firebase_admin._apps:
            decoded_creds = base64.b64decode(google_creds_base64)
            cred_json = json.loads(decoded_creds)
            cred = credentials.Certificate(cred_json)
            firebase_admin.initialize_app(cred)
    except Exception as e:
        print(f"Error initializing Firebase Admin SDK from Base64: {e}") 
else:
    # Альтернативно, если GOOGLE_APPLICATION_CREDENTIALS указывает на путь к файлу в контейнере Koyeb
    google_creds_path = os.environ.get('GOOGLE_APPLICATION_CREDENTIALS')
    if google_creds_path:
        try:
            if not firebase_admin._apps:
                 cred = credentials.Certificate(google_creds_path)
                 firebase_admin.initialize_app(cred)
        except Exception as e:
            print(f"Error initializing Firebase Admin SDK from path: {e}")
    else:
        print("GOOGLE_APPLICATION_CREDENTIALS or its Base64 version not set for Koyeb.")
```

IX. Обратная Связь и Планы Тестирования (Обновлено для текущего стека)
9.1. Общие Принципы Тестирования... текущий этап фокусируется на достижении стабильной функциональности **на стеке Koyeb, Cloudflare R2, Neon.tech и Firebase**.

9.2. План Внутреннего Тестирования (Текущий Стек)
Цель: Проверить работоспособность ключевых функций текущего этапа, развернутых на **Koyeb и Firebase Hosting**...
Этап 1: Тестирование Фронтенда на Firebase Hosting (API запросы идут на Koyeb).
Этап 2: Тестирование **FastAPI Бэкенда на Koyeb**
Задачи:
- Проверка FastAPI эндпоинтов на Koyeb...
- Анализ логов **Koyeb** для выявления ошибок и оценки производительности.
Инструменты: Postman/curl (для HTTP-запросов к FastAPI на Koyeb), **веб-интерфейс Koyeb (логи, метрики)**, `psql`.

Этап 3: Интеграционное Тестирование (E2E для текущего этапа)
Задачи:
- Сквозное тестирование всего цикла:
    2. Загрузка медиа-"чанка" (Frontend -> **FastAPI на Koyeb** -> Cloudflare R2).
Инструменты: ..., **логи Koyeb**, Firebase Console (для Auth, Hosting).

9.4. Автоматизация Тестирования (Постепенное Внедрение)
CI/CD: ... **Автоматизация развертывания на Koyeb (через GitHub Actions триггеря Koyeb или напрямую деплоя Docker образа) и Firebase Hosting.**

9.5. Риски и Меры (в контексте тестирования)
Риск 2: Сложности с отладкой интеграционных проблем **между Firebase Hosting, Koyeb, R2 и Neon.tech**.
Риск 3: Ограничения среды **Koyeb Hobby Plan** (засыпание, лимиты ресурсов) могут влиять на тесты производительности или длительные операции.
Мера: Осознание этих ограничений, фокус на функциональном тестировании для текущего этапа. Использование платных планов Koyeb или других платформ для более серьезного тестирования производительности.

X. Долгосрочные Цели и Видение (Актуализировано с учетом текущего стека)
10.1. Общее Видение Проекта
... текущая реализация, построенная на **Koyeb, Cloudflare R2, Neon.tech и Firebase**, является первым шагом...

10.5. Стратегические Риски и Меры (Долгосрочные)
Риск 4: Эволюция облачных платформ (**Koyeb, Cloudflare, Neon.tech, Firebase/GCP**)...
```
