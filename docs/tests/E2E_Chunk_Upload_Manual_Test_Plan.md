# План E2E Тестирования Загрузки Interaction Chunk

**ID для отчета:** [20240726-1027-029]
**Цель:** Подготовить план End-to-End тестирования для проверки всего потока загрузки "Interaction Chunk" и его базовой обработки.

## Предусловия:
*   Пользователь аутентифицирован (JWT токен получен и используется для запросов, где это необходимо).
*   `firebaseStorageService.js` (на фронтенде) и `process_chunk` Cloud Function (с интеграцией `ChunkProcessorBot` на бэкенде) развернуты и работают.
*   Доступ к Firebase Console, Google Cloud Console (Logs Explorer) и клиенту PostgreSQL (для Neon.tech).

## Шаги Тестирования (Выполнять последовательно):

### Шаг 1: Загрузка файла на фронтенде
*   **Действие:** Используя UI (например, кнопку "Upload" или аналогичный элемент, управляемый `uiManager.js`), выбрать тестовый медиа-файл (например, небольшой `.wav` или `.mp4` файл).
*   **Ожидаемый результат:** Файл выбран, начинается процесс загрузки. UI отображает индикацию загрузки (если реализовано).
*   **Место проверки:** Пользовательский интерфейс (UI) приложения, консоль браузера (для ошибок/логов JavaScript).
*   **Необходимые инструменты/данные:** Тестовый медиа-файл (аудио или видео), браузер с доступом к фронтенду приложения.

### Шаг 2: Проверка загрузки в Firebase Storage
*   **Действие:** После завершения загрузки на фронтенде, перейти в Firebase Console и проверить Firebase Storage.
*   **Ожидаемый результат:** Файл успешно загружен в Firebase Storage в корректную директорию (например, `user_uploads/<user_id>/<filename_or_chunk_id>`). Метаданные файла (например, `name`, `type`, `clientTimestamp`, `user_id`, `chunk_id`) корректно сохранены как метаданные объекта в Firebase Storage.
*   **Место проверки:** Firebase Console (раздел "Storage").
*   **Необходимые инструменты/данные:** Доступ к Firebase Console.

### Шаг 3: Проверка вызова `process_chunk` Cloud Function
*   **Действие:** Перейти в Google Cloud Console и проверить логи Cloud Function `process_chunk`.
*   **Ожидаемый результат:** Функция `process_chunk` была вызвана триггером Firebase Storage после завершения загрузки файла. В логах функции должно быть видно получение события о загрузке файла и начало его обработки, включая вызов `ChunkProcessorBot`.
*   **Место проверки:** Google Cloud Console (раздел "Logs Explorer" для Cloud Functions).
*   **Необходимые инструменты/данные:** Доступ к Google Cloud Console.

### Шаг 4: Проверка сохранения метаданных в PostgreSQL
*   **Действие:** Подключиться к базе данных Neon.tech PostgreSQL и проверить таблицу `audiovisual_gestural_chunks`.
*   **Ожидаемый результат:** Для загруженного чанка создана новая запись. Поля записи (`chunk_id`, `user_id`, `chunk_type`, `storage_ref`, `original_filename`, `mime_type`, `custom_metadata_json` и др.) корректно заполнены на основе данных из Firebase Storage и результатов работы `ChunkProcessorBot`.
*   **Место проверки:** Клиент PostgreSQL (например, DBeaver, psql или любой другой удобный клиент), подключенный к БД Neon.tech.
*   **Необходимые инструменты/данные:** Учетные данные для доступа к БД Neon.tech PostgreSQL, SQL-клиент.

### Шаг 5: Проверка логирования в `tria_learning_log` (если применимо)
*   **Действие:** Подключиться к базе данных Neon.tech PostgreSQL и проверить таблицу `tria_learning_log`.
*   **Ожидаемый результат:** Запись о событии "chunk_metadata_processed" (или аналогичном, созданном `ChunkProcessorBot` после успешной обработки чанка) создана. Эта запись должна содержать релевантную информацию о событии.
*   **Место проверки:** Клиент PostgreSQL, подключенный к БД Neon.tech.
*   **Необходимые инструменты/данные:** Учетные данные для доступа к БД Neon.tech PostgreSQL, SQL-клиент.
