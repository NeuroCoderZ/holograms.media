# План E2E Тестирования Взаимодействия с Tria Bot

**ID для отчета:** [20240726-1028-030]
**Цель:** Подготовить план End-to-End тестирования для проверки базового взаимодействия с Tria ботом (ChatBot).

## Предусловия:
*   Пользователь аутентифицирован, JWT токен получен и используется для всех необходимых запросов.
*   Firebase Cloud Function `tria_chat_handler` развернута и доступна (или локальный эмулятор Firebase запущен, и URL в `apiService.js` актуализирован).
*   Backend-компоненты `ChatBot.py` и `LLMService` (с использованием предоставленного ключа Mistral) сконфигурированы и функционируют корректно.
*   На фронтенде реализован механизм отправки сообщений через UI чата (например, через `chatInput` и `submitChatMessage` в `uiManager.js` и `chat.js`).
*   Доступ к Google Cloud Console (Logs Explorer для Cloud Functions) и клиенту PostgreSQL (для Neon.tech).

## Шаги Тестирования (Выполнять последовательно):

### Шаг 1: Отправка сообщения из фронтенд-приложения
*   **Действие:** Открыть чат-интерфейс в приложении (например, через кнопку "Chat"). Ввести тестовое сообщение (например, "Привет, Триа, как дела?") в поле ввода чата (`chatInput`) и нажать кнопку "Отправить" (`submitChatMessage`).
*   **Ожидаемый результат:** Сообщение пользователя появляется в истории чата на фронтенде. На фронтенде может появиться индикатор отправки/ожидания ответа от Триа.
*   **Место проверки:** Пользовательский интерфейс (UI) приложения (панель чата).
*   **Необходимые инструменты/данные:** Фронтенд-приложение, тестовое сообщение.

### Шаг 2: Проверка вызова `tria_chat_handler` Cloud Function
*   **Действие:** Перейти в Google Cloud Console и проверить логи Cloud Function `tria_chat_handler`.
*   **Ожидаемый результат:** В логах функции `tria_chat_handler` должна быть видна запись о получении входящего HTTP-запроса от фронтенда, содержащего отправленное сообщение пользователя. Должны быть записи о начале обработки запроса, верификации токена и извлечении `firebase_user_id`.
*   **Место проверки:** Google Cloud Console (раздел "Logs Explorer" для Cloud Functions `tria_chat_handler`).
*   **Необходимые инструменты/данные:** Доступ к Google Cloud Console.

### Шаг 3: Проверка вызова `ChatBot.py` и `LLMService`
*   **Действие:** Продолжить анализ логов Cloud Function `tria_chat_handler`.
*   **Ожидаемый результат:** В логах должны быть видны записи, подтверждающие, что `ChatBot` был инициализирован и вызвал `LLMService` для получения ответа от языковой модели. Могут быть логи, указывающие на модель, используемую `LLMService` (например, `mistral-medium-latest`).
*   **Место проверки:** Google Cloud Console (логи `tria_chat_handler`).
*   **Необходимые инструменты/данные:** Доступ к Google Cloud Console.

### Шаг 4: Проверка ответа от LLM API
*   **Действие:** Продолжить анализ логов Cloud Function `tria_chat_handler`.
*   **Ожидаемый результат:** В логах должна быть запись о получении ответа от LLM API (например, Mistral). Сам ответ или его часть могут быть залогированы для проверки содержимого.
*   **Место проверки:** Google Cloud Console (логи `tria_chat_handler`).
*   **Необходимые инструменты/данные:** Доступ к Google Cloud Console.

### Шаг 5: Проверка отображения ответа Tria бота в UI
*   **Действие:** Вернуться на фронтенд-приложение и проверить историю чата.
*   **Ожидаемый результат:** Ответ, полученный от Триа бота, должен появиться в чате на фронтенде, как новое сообщение от бота, после сообщения пользователя.
*   **Место проверки:** Пользовательский интерфейс (UI) приложения (панель чата).
*   **Необходимые инструменты/данные:** Фронтенд-приложение.

### Шаг 6: Проверка логирования взаимодействия в `tria_learning_log`
*   **Действие:** Подключиться к базе данных Neon.tech PostgreSQL и проверить таблицу `tria_learning_log`.
*   **Ожидаемый результат:** В таблице `tria_learning_log` должна быть новая запись с `event_type = 'tria_chat_interaction'`, содержащая `user_id`, `prompt_text` (сообщение пользователя) и `tria_response_text` (ответ бота). Поле `model_used` также должно быть корректно заполнено.
*   **Место проверки:** Клиент PostgreSQL, подключенный к БД Neon.tech.
*   **Необходимые инструменты/данные:** Учетные данные для доступа к БД Neon.tech PostgreSQL, SQL-клиент.
