# Project Rules for Holograms Media (holograms.media) - v27.0

## 1. General Principles & Philosophy
- **R&D Platform:** Проект "Голографические Медиа" - это исследовательская инициатива, нацеленная на создание новой парадигмы коммуникации.
- **Open Source (MIT):** Чистый, понятный, модульный код.
- **Итеративность:** Микро-шаги, быстрая адаптация.
- **Нейрокодинг + Верификация:** Используем Trae IDE (Claude 3.x, Gemini 2.5 Pro) как основной инструмент. **Весь AI-сгенерированный код тщательно проверяется, тестируется и понимается НейроКодером перед коммитом.** AI – соавтор.
- **Ручной Контроль:** Решения НейроКодера в приоритете.
- **Документирование:** Поддержание актуальности Системной Инструкции, README, Issues.
- **Безопасность:** Секреты (`MONGO_URI`, `MISTRAL_API_KEY` и др.) только через переменные окружения (`.env` локально, Secrets на HF).

## 2. Core Technologies & Stack
- **Backend:** Python 3.12, FastAPI, Uvicorn.
- **Frontend:** JavaScript (ES6 Modules), Three.js (r128), HTML5, CSS3.
    - **Важно:** Статика из `frontend/` отдается по `/static/`. Пути в `index.html` должны это учитывать. Внутри JS-модулей (`frontend/js/`) предпочтительны относительные пути импорта.
- **База данных:** MongoDB Atlas (через Motor async driver).
- **AI (LLM для Триа):** LangChain, Mistral API (через `ChatMistralAI`).
- **Мультимодальность (Текущее/WIP):** Web Speech API (распознавание/синтез), MediaPipe Hands (базовая интеграция).
- **Развертывание:** Hugging Face Spaces (Docker).
- **CI/CD:** GitHub Actions.
- **Долгосрочные Технологии (R&D):** Вейвлет-анализ, WebAssembly, высокоточные жесты (включая акустическую локацию), WebXR, WebGPU, Блокчейн ("Инфокойн"), Векторные БД.

## 3. Ключевые Файлы и Их Назначение
- **`app.py`**: Основной файл бэкенда FastAPI. API эндпоинты, инициализация LLM, логика подключения к MongoDB (`get_database()`).
- **`frontend/index.html`**: Главный HTML-файл. Точка входа для JS и CSS. **Пути к JS/CSS должны быть `/static/...`**.
- **`frontend/js/main.js`**: Основной JS-модуль для инициализации новой модульной структуры фронтенда. Импортирует и запускает другие модули из `frontend/js/`. **Импорты внутри него должны быть относительными к существующим файлам.**
- **`frontend/script.js`**: Устаревший монолитный JS (старая 3D-сцена, обработчики). Постепенно рефакторится.
- **`frontend/style.css`**: Основные стили.
- **`frontend/js/core/`**: Базовая логика UI, события.
- **`frontend/js/panels/`**: Логика UI-панелей (чат, таймлайн и др.).
- **`frontend/js/ai/`**: Фронтенд-логика для взаимодействия с Триа.
- **`frontend/js/audio/speechInput.js`**: Распознавание речи.
- **Отсутствующие модули (планируются):** `frontend/js/3d/`, `frontend/js/gestures/` (кроме панелей), `frontend/js/audio/` (кроме `speechInput.js`), некоторые `frontend/js/utils/`.

## 4. Правила Работы с Кодом
- **Коммиты:** Осмысленные сообщения, конвенция (`feat:`, `fix:`, `refactor:`, `chore:`, `docs:`). Связывай с Issues (`closes #ID`).
- **JavaScript:** ES6+, модульность. Рефакторинг `script.js` – приоритет.
- **Python (`app.py`):** Async/await, PEP 8 (цель), тщательная обработка ошибок и логирование.
- **Обработка ошибок MongoDB в `app.py`:** Эндпоинт `/chat` не должен падать с 500 из-за ошибки БД, если ответ от LLM получен. Логировать ошибку БД, вернуть ответ LLM с примечанием.

## 5. Взаимодействие с AI-Ассистентом (Trae IDE)
- **Промптинг:** Четкие микропромпты по "Схеме Промта v1.0". Контекст: `@workspace`, `@file`, `#Project Rules`.
- **Ожидаемый Отчет от AI (ПОСЛЕ выполнения):**
    1.  Подтверждение выполнения всех инструкций.
    2.  Для КАЖДОГО измененного файла (единым текстом для каждого):
        *   **Имя файла.**
        *   **БЫЛО:** Фрагмент(ы) кода до изменений.
        *   **СТАЛО:** Тот же фрагмент(ы) кода после изменений.
    3.  ПОЛНЫЙ ВЫВОД терминальных команд (если были запрошены).
    4.  Краткое объяснение логики сложных изменений.
- **Тестирование:** AI выполняет базовые тесты (`uvicorn`, `curl`). НейроКодер верифицирует.
- **Git:** Если в промпте указано "ЗАДАЧA НА КОММИТ И PUSH", AI **ДОЛЖЕН** выполнить `git add`, `git commit` (с предложенным сообщением) и `git push origin main` через терминал и предоставить их ПОЛНЫЙ ВЫВОД.

## 6. Текущие Приоритеты и Задачи (для AI)
1.  **Устранить ошибку 500 на эндпоинте `/chat` в `app.py`**, связанную с MongoDB. Обеспечить корректное сохранение истории чата или graceful-деградацию с логированием. (Issue #1)
2.  **Проверить и исправить пути в `index.html`** для `script.js`, `tria_mode.js`, `rightPanelManager.js`, `chatMessages.js`, если они все еще некорректны (должны быть `/static/...`).
3.  **Проверить и исправить импорты в `main.js`** на корректные относительные пути к СУЩЕСТВУЮЩИМ файлам. Удалить/закомментировать код, связанный с отсутствующими модулями.
4.  **Рассмотреть Issue #11:** "Фронтенд: Реализовать область визуализации и взаимодействия с жестами (#gesture-area)". Начать с HTML/CSS и базовой JS-логики появления/скрытия.

## 7. Фокус на AI "Триа" и Жестах (Долгосрочно, но учитывать при проектировании)
- **Сбор данных:** Любое взаимодействие (клик, жест, голосовая команда) – потенциальные данные для обучения Триа. Предусматривать логирование.
- **Векторная структура:** В перспективе, код, документация, жесты, взаимодействия будут представлены как эмбеддинги для Триа.
- **Жестовое управление:** Конечная цель – интуитивное жестовое управление платформой и данными.
- **"Медленное обучение Триа":** Триа должна получать обратную связь (возможно, через систему "очков" или прото-токены) за успешные действия и интерпретации.

## 8. Важно для AI при модификации кода:
- **Не удаляй импорты или код без явного указания или если не уверен, что модуль действительно отсутствует и не будет добавлен в ближайшее время.** Лучше закомментируй с `// TODO: ...`.
- Придерживайся стиля существующего кода.
- Если задача неясна или требует доступа к информации вне `@workspace` (например, настройки секретов на HF), сообщи об этом.