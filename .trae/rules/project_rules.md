# Project Rules for Holograms Media (holograms.media) - v29.1

## 0. Актуальный Контекст Проекта (КРИТИЧЕСКИ ВАЖНО!)
- **Перед выполнением любой задачи, AI ОБЯЗАН ознакомиться с файлом `@PROJECT_CONTEXT.md` в корне проекта.** Этот файл содержит актуальный срез состояния, цели и последние изменения.
- Если `@PROJECT_CONTEXT.md` отсутствует или устарел, AI должен сначала выполнить задачу по его созданию/актуализации.
- **Системная Инструкция (текущая версия v29.0 или новее)** является основным документом, описывающим архитектуру и цели. Ссылайся на нее.

## 1. General Principles & Philosophy
- **R&D Platform:** Проект "Голографические Медиа" - исследовательская инициатива, новая парадигма коммуникации.
- **Open Source (MIT):** Чистый, понятный, **модульный** код – ключ к успеху.
- **Итеративность:** Микро-шаги, быстрая адаптация. Рефакторинг – непрерывный процесс.
- **Нейрокодинг + Верификация:** Trae IDE (Claude 3.x, Gemini 2.5 Pro) – основной инструмент. **Весь AI-код тщательно проверяется, тестируется и понимается НейроКодером перед коммитом.** AI – соавтор.
- **Ручной Контроль:** Решения НейроКодера в приоритете.
- **Документирование:** Актуальная Системная Инструкция, `@PROJECT_CONTEXT.md`, `@tria_memory_buffer.md` (для лога итераций), README, Issues.
- **Безопасность:** Секреты (`POSTGRES_URI`, `MISTRAL_API_KEY` и др.) только через переменные окружения (`.env` локально, Secrets на HF).

## 2. Core Technologies & Stack (Целевая)
- **Backend:** Python 3.12, FastAPI, Uvicorn.
- **Frontend:** JavaScript (ES6 Modules), Three.js (r128+), HTML5, CSS3. **Цель: WebGPU для рендеринга.**
    - **Важно:** Статика из `frontend/` отдается по `/static/`. Пути в `index.html` к основным скриптам должны быть `/static/...`. Внутри JS-модулей (`frontend/js/`) – относительные пути импорта.
- **База данных (Целевая):** **PostgreSQL с расширением `pgvector`** (драйвер `asyncpg`).
- **AI (LLM для Триа):** LangChain, Mistral API.
- **Мультимодальность:** WebRTC, Web Audio API, MediaPipe Hands.
- **Развертывание:** Hugging Face Spaces (Docker).
- **CI/CD:** GitHub Actions.
- **Долгосрочные Технологии (R&D):** Вейвлет-анализ, WebAssembly, WebXR, "Инфокойн" (блокчейн), Векторные БД (в рамках PostgreSQL или выделенные), TypeScript.

## 3. Ключевые Файлы и Их Назначение (Ориентир - см. `@PROJECT_CONTEXT.md` для актуальной структуры)
- **`backend/app.py` (или `backend/main.py`)**: Бэкенд FastAPI.
- **`frontend/index.html`**: Главный HTML.
- **`frontend/js/main.js`**: Точка входа для ES6 модулей фронтенда.
- **`frontend/script.js`**: **Устаревший монолит. Подлежит ПОЛНОМУ РЕФАКТОРИНГУ** с переносом функционала в модули в `frontend/js/`.
- **`frontend/js/core/init.js`**: Инициализация глобального `state`.
- **`frontend/js/3d/sceneSetup.js`**: Инициализация Three.js/WebGPU сцены, объектов в `state`.
- **`PROJECT_CONTEXT.md`**: **Главный файл с актуальным состоянием проекта для AI.**
- **`tria_memory_buffer.md`**: Детальный лог итераций разработки (обновляется AI).

## 4. Правила Работы с Кодом
- **Коммиты:** Осмысленные, по конвенции (`feat:`, `fix:`, `refactor:`). Ссылайся на Issues.
- **JavaScript:** ES6+, **акцент на модульность**. **РЕФАКТОРИНГ `script.js` – ВЫСШИЙ ПРИОРИТЕТ.**
- **Python:** Async/await, PEP 8 (цель), логирование.
- **PostgreSQL:** Использование `asyncpg`, проектирование схем с учетом векторов и JSONB.

## 5. Взаимодействие с AI-Ассистентом (Trae IDE)
- **Промптинг:** Четкие микропромпты по "Универсальному Шаблону Промта v3.0" (см. User Rules). Контекст: `@workspace`, `@file`, `#Project Rules`, `@PROJECT_CONTEXT.md`.
- **Ожидаемый Отчет от AI (ПОСЛЕ выполнения):**
    1.  Подтверждение ознакомления с `@PROJECT_CONTEXT.md`.
    2.  Подтверждение выполнения основной задачи.
    3.  Для КАЖДОГО измененного файла: **Имя файла; БЫЛО: (фрагмент); СТАЛО: (фрагмент).**
    4.  ПОЛНЫЙ ВЫВОД терминальных команд (включая MCP, если использовался).
    5.  Краткое объяснение.
    6.  **Предложения по обновлению `@PROJECT_CONTEXT.md` и `@tria_memory_buffer.md`.**
- **Тестирование:** AI выполняет базовые тесты. НейроКодер верифицирует.
- **Git (через MCP GitHub или Terminal):** Если в промпте "ЗАДАЧА НА GIT", AI **ДОЛЖЕН** попытаться выполнить команды и предоставить ПОЛНЫЙ ВЫВОД. **Сервер должен быть остановлен перед этим.**

## 6. Текущие Приоритеты и Задачи (для AI - см. актуальный `@PROJECT_CONTEXT.md`)
1.  **КРИТИЧНО:** Устранение блокирующих JS ошибок в `script.js` для обеспечения загрузки фронтенда.
2.  **РЕФАКТОРИНГ `frontend/script.js`:** Последовательный перенос логики в модули.
3.  **ПОДГОТОВКА К PostgreSQL:** Анализ кода бэкенда, планирование миграции.

## 7. Фокус на AI "Триа" и Жестах (Долгосрочно)
- Сбор "комбинированных аудио(видео)-чанков". Векторные эмбеддинги в PostgreSQL.

## 8. Важно для AI при модификации кода:
- **Приоритет – рефакторинг `script.js` и устранение ошибок.**
- Не удаляй код безвозвратно, если не уверен. Лучше закомментируй с `// TODO: ...`.
- Если задача неясна или противоречит `@PROJECT_CONTEXT.md`, уточни.