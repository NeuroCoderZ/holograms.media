# Project Rules for Holograms Media (holograms.media)

## 1. General Principles & Philosophy
- **R&D Platform:** Проект "Голографические Медиа" - исследовательская инициатива, новая парадигма коммуникации.
- **Open Source (MIT):** Чистый, понятный, **модульный** код – ключ к успеху.
- **Итеративность:** Микро-шаги, быстрая адаптация. Рефакторинг – непрерывный процесс.
- **Нейрокодинг + Верификация:** Trae IDE (Claude 3.x, Gemini 2.5 Pro) – основной инструмент. **Весь AI-код тщательно проверяется, тестируется и понимается НейроКодером перед коммитом.** AI – соавтор.
- **Ручной Контроль:** Решения НейроКодера в приоритете.
- **Документирование:** Актуальная Системная Инструкция (сейчас v28.0), README, Issues.
- **Безопасность:** Секреты (`MONGO_URI`, `MISTRAL_API_KEY` и др.) только через переменные окружения (`.env` локально, Secrets на HF).

## 2. Core Technologies & Stack
- **Backend:** Python 3.12, FastAPI, Uvicorn.
- **Frontend:** JavaScript (ES6 Modules), Three.js (r128), HTML5, CSS3.
    - **Важно:** Статика из `frontend/` отдается по `/static/`. Пути в `index.html` к основным скриптам (script.js, tria_mode.js, main.js, панели) должны быть `/static/...`. Внутри JS-модулей (`frontend/js/`) – относительные пути импорта.
- **База данных:** MongoDB Atlas (Motor async driver).
- **AI (LLM для Триа):** LangChain, Mistral API (через `ChatMistralAI`).
- **Мультимодальность (WIP):** Web Speech API. MediaPipe Hands (временно отключен из-за проблем на HF, см. Issue #21).
- **Развертывание:** Hugging Face Spaces (Docker).
- **CI/CD:** GitHub Actions (перезапуск HF).
- **Долгосрочные Технологии (R&D):** Вейвлет-анализ, WebAssembly (C++/Rust), высокоточные жесты (акустическая локация), WebXR, WebGPU, Блокчейн (**"ГолоГраф"** – новое рабочее название для Инфокойна), Векторные БД (Pinecone/Weaviate/Milvus), TypeScript, React/Vue/Svelte, PyTorch, Kubernetes.

## 3. Ключевые Файлы и Их Назначение (Ориентир)
- **`app.py`**: Бэкенд FastAPI. API, LLM, DB (`get_database()`).
- **`frontend/index.html`**: Главный HTML.
- **`frontend/js/main.js`**: Точка входа для ES6 модулей фронтенда. Импортирует и инициализирует другие модули.
- **`frontend/script.js`**: **Устаревший монолит.** Содержит много логики Three.js, UI, обработчиков. **Подлежит АКТИВНОМУ РЕФАКТОРИНГУ** с переносом функционала в новые модули в `frontend/js/`.
- **`frontend/js/core/init.js`**: Инициализация глобального объекта `state`, включая объекты Three.js из `sceneSetup.js`.
- **`frontend/js/3d/sceneSetup.js`**: Модуль для всей инициализации Three.js (сцена, камера, рендерер, свет, геометрия голограммы, `animate()`).
- **`frontend/js/ui/uiManager.js`**: Модуль для инициализации DOM-элементов UI и базовых обработчиков UI (панели, кнопки).
- **Другие модули в `frontend/js/`**: `core/events.js`, `panels/*`, `ai/*`, `audio/speechInput.js`.
- **Отсутствующие модули (планируются):** Детализация жестов, аудио-визуализации, утилиты.

## 4. Правила Работы с Кодом
- **Коммиты:** Осмысленные, по конвенции (`feat:`, `fix:`, `refactor:`). Ссылайся на Issues (`closes #ID`).
- **JavaScript:** ES6+, **акцент на модульность**. **РЕФАКТОРИНГ `script.js` – ВЫСШИЙ ПРИОРИТЕТ.**
- **Python (`app.py`):** Async/await, PEP 8 (цель), логирование.
- **MongoDB в `app.py`:** Эндпоинт `/chat` не должен падать из-за ошибки БД, если ответ LLM получен.

## 5. Взаимодействие с AI-Ассистентом (Trae IDE)
- **Промптинг:** Четкие микропромпты по "Схеме Промта v1.0" (см. User Rules). Контекст: `@workspace`, `@file`, `#Project Rules`.
- **Ожидаемый Отчет от AI (ПОСЛЕ выполнения):**
    1.  Подтверждение.
    2.  Для КАЖДОГО измененного файла (единым текстом): **Имя файла; БЫЛО: (фрагмент); СТАЛО: (фрагмент).**
    3.  ПОЛНЫЙ ВЫВОД терминальных команд.
    4.  Краткое объяснение.
- **Тестирование:** AI выполняет базовые тесты (`uvicorn`, `curl`). НейроКодер верифицирует UI.
- **Git:** Если в промпте "ЗАДАЧA НА КОММИТ И PUSH", AI **ДОЛЖЕН** выполнить `git add`, `git commit`, `git push` через терминал и предоставить ПОЛНЫЙ ВЫВОД. **Сервер Uvicorn должен быть остановлен перед этим.**

## 6. Текущие Приоритеты и Задачи (для AI)
1.  **РЕФАКТОРИНГ `frontend/script.js`:**
    *   **КРИТИЧНО:** Устранить ошибку `TypeError: Assignment to constant variable` (строка ~1139 в последней известной версии `script.js` до попыток рефакторинга).
    *   Продолжить перенос логики из `script.js` в модули (`sceneSetup.js`, `uiManager.js`, и далее по функциональным блокам).
2.  **Стабилизация UI:**
    *   Обеспечить корректную работу кнопки "Чат" (переключение вида, вызов `loadChatHistory`).
    *   Исправить логику кнопки "Триа" в `tria_mode.js` (убрать инфо-окно, корректный URL для `/tria/invoke`).
    *   Устранить предупреждение `[Events/resize] Skipping updateHologramLayout...`.
3.  **Новый функционал (после стабилизации и рефакторинга):**
    *   Issue #11: Каркас области жестов.
    *   Issue #4: Скроллинг чата.
    *   UI для "Мои жесты" / "Мои голограммы".

## 7. Фокус на AI "Триа" и Жестах (Долгосрочно)
- Сбор данных для обучения Триа. Векторная структура. Жестовое управление. "Медленное обучение Триа".

## 8. Важно для AI при модификации кода:
- **Приоритет – рефакторинг `script.js` на модули.** Если текущая задача – исправление бага в `script.js`, старайся попутно выносить исправляемый блок в модуль, если это логично.
- Не удаляй код безвозвратно, если не уверен. Лучше закомментируй с `// TODO: ...`.
- Придерживайся стиля существующего кода в модулях.
- Если задача неясна, уточни.