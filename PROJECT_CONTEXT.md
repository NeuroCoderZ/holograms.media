# Актуальный Контекст Проекта Holograms Media (v29.0) - Обновлено: 2025-05-19

## 0. Важная Информация для AI
- **Основной документ:** Системная Инструкция (текущая версия v29.0+).
- **Этот файл (`PROJECT_CONTEXT.md`):** Актуальный срез состояния, цели, ключевые файлы, проблемы. AI ОБЯЗАН ознакомиться перед каждой задачей.
- **Лог итераций:** `@tria_memory_buffer.md`.

## 1. Обзор и Цели Проекта
- **Имя:** holograms.media
- **Репозиторий:** `https://github.com/NeuroCoderZ/holograms.media`
- **Миссия:** R&D платформа для создания интерактивных 3D-аудиовизуализаций ("голограмм") с AI "Триа", стремящаяся к новому языку коммуникации. Преодоление симуляционно-реального разрыва через обучение Триа на "комбинированных аудио(видео)-чанках".
- **Лицензия:** MIT.
- **Системная Инструкция:** v29.0 (основной источник архитектуры и философии).

## 2. Ключевые Технологии (Целевые)
- **Backend:** Python 3.12+, FastAPI, Uvicorn, **PostgreSQL + `pgvector` (драйвер `asyncpg`)**.
- **Frontend:** JavaScript (ES6 Modules), Three.js (r128+), **WebGPU (цель)**, WebRTC, Web Audio API, MediaPipe Hands.
- **AI "Триа":** Сеть ботов (Аудио, Жесты, Память, Обучение), LangChain, RAG, Continual Learning, UMAP, Генетические алгоритмы.
- **Развертывание:** Hugging Face Spaces (Docker).
- **CI/CD:** GitHub Actions.

## 3. Структура Проекта и Ключевые Файлы
- **`backend/app.py`**: Основной файл FastAPI бэкенда.
- **`backend/requirements.txt`**: Зависимости Python.
- **`backend/tria_bots/`**: Директория для модулей ботов Триа (пока заглушки).
- **`frontend/index.html`**: Главный HTML.
- **`frontend/js/main.js`**: Точка входа и оркестратор ES6 модулей фронтенда.
- **`frontend/js/core/init.js`**: Инициализация глобального `state`.
- **`frontend/js/3d/sceneSetup.js`**: Инициализация 3D-сцены (Three.js/WebGPU).
- **`frontend/js/rendering.js`**: Логика рендеринга аудиовизуализации.
- **`frontend/js/audio/`**: Модули для аудио (`microphoneManager.js`, `audioFilePlayer.js`, `speechInput.js`).
- **`frontend/js/ui/`**: Модули UI (`uiManager.js`, `panelManager.js`, `layoutManager.js`).
- **`frontend/js/core/`**: Ядро фронтенда (`events.js`, `diagnostics.js`, `resizeHandler.js`, `domEventHandlers.js`).
- **`frontend/js/xr/`**: Модули для XR и камеры (`cameraManager.js`).
- **`frontend/js/multimodal/`**: Модули для мультимодального ввода (например, `handsTracking.js`).
- **`frontend/script.js`**: **Устаревший монолит. РЕФАКТОРИНГ ЗАВЕРШЕН И ФАЙЛ УДАЛЕН** - весь функционал перенесен в модули в `frontend/js/`.
- **`Dockerfile`**: Конфигурация Docker для HF Spaces (пути к `backend/app.py` и `backend/requirements.txt` должны быть верны).
- **`PROJECT_CONTEXT.md`**: Этот файл.
- **`tria_memory_buffer.md`**: Лог итераций.

## 4. Текущий Фокус Разработки (2025-05-19)
1.  **ЗАВЕРШЕН РЕФАКТОРИНГ И УДАЛЕНИЕ `frontend/script.js`:** Весь функционал успешно перенесен в ES6 модули, файл удален.
2.  **Стабилизация фронтенда:** Устранение JS ошибок, возникающих после рефакторинга, обеспечение корректной работы всех перенесенных функций.
3.  **Подготовка к миграции бэкенда на PostgreSQL:** Анализ `backend/app.py`, проектирование схемы БД.

## 5. Последние Ключевые Изменения (Хронология)
- **[2025-05-19]** Исправлен `Dockerfile` для корректной работы с новой структурой бэкенда (`backend/app.py`, `backend/requirements.txt`). (Коммит cc95d26)
- **[2025-05-18]** Реструктуризация папки `backend/`: `app.py`, `requirements.txt` перемещены в `backend/`, создана папка `backend/tests/` и `backend/tria_bots/`. Удалены старые бэкапы и `Jenkinsfile`. (Коммит af92652)
- **[2025-05-18]** Устранены ошибки дублирования объявлений для `createSphere/Line/Axis/Grid` в `script.js`. (Коммит 24e120e)
- **[2025-05-18]** Логика MediaPipe Hands перенесена из `script.js` в `handsTracking.js`, обновлен `main.js`. (Коммит 4cd726a)
- *Более ранние изменения см. в `tria_memory_buffer.md` или истории коммитов.*

## 6. Критические Известные Проблемы и Блокеры (2025-05-19)
- **`frontend/script.js` (~390-575 строк):** Все еще содержит остаточную логику, которую необходимо полностью перенести в модули. **Блокирует чистоту архитектуры.**
- **Ошибки JS на фронтенде (после рефакторинга):** Вероятны ошибки `ReferenceError` или некорректная работа функций из-за "оставшихся ссылок" или неправильной интеграции модулей. Требуется тщательное тестирование после каждого этапа переноса.
- **Дублирующиеся JS модули:** Устранены дубликаты `domEventHandlers.js` и `chatMessages.js`.

## 7. Планы по AI "Триа" и PostgreSQL
- После стабилизации фронтенда начнется активная работа по миграции бэкенда на PostgreSQL с `pgvector`.
- Затем – реализация логики ботов Триа в `backend/tria_bots/`.