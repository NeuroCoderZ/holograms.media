# Project Context

## Основная информация
- **Имя**: holograms.media
- **Репо**: `https://github.com/NeuroCoderZ/holograms.media`
- **Стек (ключевое)**: Frontend (JS, Three.js), Backend (Python, FastAPI, PostgreSQL - планируется), Trae IDE
- **Системная Инструкция**: v29.0
- **Текущие цели**: Стабилизация фронтенда, рефакторинг `script.js`, подготовка к миграции на PostgreSQL

## Последние Ключевые Изменения
- [YYYY-MM-DD] Рефакторинг script.js: логика аудио плеера и XR вынесена в модули audioFilePlayer.js и cameraManager.js.
- [2023-11-15] Устранены ошибки дублирования объявлений для createSphere/Line/Axis/Grid в script.js.
- [YYYY-MM-DD] Устранены ошибки JS в cameraManager.js и script.js.
# Актуальный Контекст Проекта Holograms Media

## 0. Важная Информация для AI

- Этот файл содержит актуальный срез состояния проекта, цели и последние изменения.
- Перед выполнением любой задачи, AI ОБЯЗАН ознакомиться с этим файлом.
- Системная Инструкция (текущая версия v29.0+) является основным документом, описывающим архитектуру и цели.

## 1. Общие Принципы и Философия

- R&D Платформа: Исследовательская инициатива, новая парадигма коммуникации.
- Open Source (MIT): Чистый, понятный, модульный код.
- Итеративность: Микро-шаги, быстрая адаптация. Рефакторинг – непрерывный процесс.
- Нейрокодинг + Верификация: Trae IDE – основной инструмент. Весь AI-код тщательно проверяется.
- Ручной Контроль: Решения НейроКодера в приоритете.
- Документирование: Актуальная Системная Инструкция, @PROJECT_CONTEXT.md, @tria_memory_buffer.md, README, Issues.
- Безопасность: Секреты только через переменные окружения.

## 2. Основные Технологии и Стек (Целевая)

- Backend: Python 3.12, FastAPI, Uvicorn.
- Frontend: JavaScript (ES6 Modules), Three.js (r128+), HTML5, CSS3. Цель: WebGPU.
- База данных (Целевая): PostgreSQL с расширением pgvector (драйвер asyncpg).
- AI (LLM для Триа): LangChain, Mistral API.
- Мультимодальность: WebRTC, Web Audio API, MediaPipe Hands.
- Развертывание: Hugging Face Spaces (Docker).
- CI/CD: GitHub Actions.
- Долгосрочные Технологии (R&D): Вейвлет-анализ, WebAssembly, WebXR, "Инфокойн", Векторные БД, TypeScript.

## 3. Ключевые Файлы и Их Назначение

- `backend/app.py` (или `backend/main.py`): Бэкенд FastAPI.
- `frontend/index.html`: Главный HTML.
- `frontend/js/main.js`: Точка входа для ES6 модулей фронтенда.
- **`frontend/script.js`**: **Устаревший монолит. Подлежит ПОЛНОМУ РЕФАКТОРИНГУ** с переносом функционала в модули в `frontend/js/`. Код, связанный с кнопкой микрофона (`micButton`), уже перенесен в соответствующие модули (`audio/microphoneManager.js`, `audio/speechInput.js`, `ui/uiManager.js`, `core/events.js`). Файл все еще содержит значительный объем устаревшей или немодульной логики.
- `frontend/js/core/init.js`: Инициализация глобального state.
- `frontend/js/3d/sceneSetup.js`: Инициализация Three.js/WebGPU сцены.
- `@PROJECT_CONTEXT.md`: Главный файл с актуальным состоянием проекта для AI.
- **`tria_memory_buffer.md`**: Детальный лог итераций разработки (обновляется AI). (Обновлен с учетом последних шагов).

## 4. Правила Работы с Кодом

- Коммиты: Осмысленные, по конвенции. Ссылайся на Issues.
- JavaScript: ES6+, акцент на модульность. РЕФАКТОРИНГ `script.js` – ВЫСШИЙ ПРИОРИТЕТ.
- Python: Async/await, PEP 8 (цель), логирование.
- PostgreSQL: Использование asyncpg, проектирование схем.

## 5. Взаимодействие с AI-Ассистентом (Trae IDE)

- Промптинг: Четкие микропромпты по "Универсальному Шаблону Промта". Контекст: @workspace, @file, #Project Rules, @PROJECT_CONTEXT.md.
- Ожидаемый Отчет от AI (ПОСЛЕ выполнения): Подтверждение, изменения (БЫЛО/СТАЛО), вывод команд, объяснение, предложения по обновлению контекстных файлов.
- Тестирование: AI выполняет базовые тесты. НейроКодер верифицирует.
- Git (через MCP GitHub или Terminal): Если в промпте "ЗАДАЧА НА GIT", AI ДОЛЖЕН попытаться выполнить команды. Сервер должен быть остановлен.

## 6. Текущий Фокус Разработки

- Тестирование и стабилизация фронтенда после рефакторинга `script.js`. Исправление ошибок, связанных с некорректными ссылками на функции/переменные после их переноса в модули. Подготовка к полному удалению `script.js`.

## 7. Последние Ключевые Изменения

- [YYYY-MM-DD] Масштабный рефакторинг script.js: большая часть логики (DOM-обработчики, аудио, панели, XR) вынесена в отдельные ES6 модули. Размер script.js значительно уменьшен.
- [YYYY-MM-DD] Инициализация проекта, создание базовой структуры файлов.

## 8. Критические Известные Проблемы

1. **КРИТИЧНО:** Устранение блокирующих JS ошибок в `script.js` для обеспечения загрузки фронтенда. (Частично выполнено, но могут быть новые ошибки после рефакторинга).
2. **РЕФАКТОРИНГ `frontend/script.js`:** Последовательный перенос логики в модули. (Продолжается. Код `micButton` перенесен. Проверены `cameraManager.js`, `chat.js`, `uiManager.js`, `events.js`, `main.js` - переменные объявлены корректно, инициализация чата и проверки UI элементов присутствуют, порядок вызовов в `main.js` логичен).

## 9. Фокус на AI "Триа" и Жестах (Долгосрочно)

- Сбор "комбинированных аудио(видео)-чанков". Векторные эмбеддинги в PostgreSQL.